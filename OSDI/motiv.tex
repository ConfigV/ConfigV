\section{Motivating Examples}
\label{sec-motiv}

In this section, we present several {\em tricky} configuration errors
extracted from real-world examples. 
The reason we call them tricky is that
most existing efforts, \eg, learning-based checking
efforts~\cite{zhang14encore, wang04automatic}, cannot detect
these configuration errors. We investigated 
many misconfiguration problems in practice which were caused by 
these tricky configuration errors, such as those reported on StackOverflow.

\para{Example~1: Ordering errors.} 
The first class of configuration errors we handle was first reported by 
Yin {\em et al.}~\cite{yin11anempirical}.
For instance, when a user configures PHP to run with the
Apache HTTP Server, this user might write, amongst others, 
the following lines in the configuration file.

\begin{lstlisting}[language=C, xleftmargin=.01\textwidth]
extension = mysql.so
...
extension = recode.so
\end{lstlisting} 

Such a configuration file will cause the Apache server to 
fail to start due to a segmentation fault error~\cite{yin11anempirical}. 
This is because when using PHP in Apache, the extension {\tt mysql.so} 
depends on {\tt recode.so}, and the relative ordering of two of them 
is crucial. 
We call the above example misconfiguration 
an {\em ordering error}.
Yin {\em et al.} find that ordering errors widely exist in
many system configurations, \eg, PHP and MySQL,
and typically lead to multiple system crash events;
however, there is no existing effort that can effectively solve 
or detect this problem~\cite{zhang14encore, xu15systems, xu13do}.

By using \app, the user can avoid such a configuration error.
In particular, \app is able to inform the user that {\tt recode.so} 
should appear before {\tt mysql.so}, as shown
below.

\begin{lstlisting}[language=C, xleftmargin=.01\textwidth]
ORDERING ERROR: Expected "extension" "recode.so"
BEFORE "extension" "mysql.so"
\end{lstlisting} 

\para{Example~2: Fine-grained value correlation errors.} 
In a real-world misconfiguration example~\cite{correlation}, 
a user configures his MySQL as the following.

\begin{lstlisting}[language=C, xleftmargin=.01\textwidth]
key_buffer_size = 384M
max_heap_table_size = 128M
max_connections = 64
thread_cache_size = 8
...
sort_buffer_size = 32M
join_buffer_size = 32M
read_buffer_size = 32M
read_rnd_buffer_size = 8M
...
\end{lstlisting} 

This user complained that her MySQL load was very high, causing the website's
respond speed to be very slow.
In this case, {\tt key\_buffer\_size} is used by all the threads
cooperatively, while {\tt join\_buffer} and {\tt sort\_buffer} are 
created by each thread for private use; thus, the maximum amount
of used key buffer, \ie, {\tt key\_buffer\_size} should be larger than 
{\tt join|sort\_buffer\_size} * {\tt max\_connections}. 
Clearly, in the above example, it does not hold, 
so this misconfiguration causes MySQL to load very slowly.

We call the above situation a {\em fine-grained value correlation
error}, which is a more challenging case than 
{\em value correlation error} reported
by some existing investigations~\cite{yin11anempirical, zhang14encore}.
A typical value correlation error
means one entry's value should have a certain correlation with
another entry's value. For example, in MySQL,
the value of {\tt max\_connections} should be higher than
{\tt mysql.max\_persistent}. Although some work, \eg,
EnCore~\cite{zhang14encore}, can detect the normal value
correlation case, 
no existing effort can detect fine-grained value correlation
errors, which ``hide'' equation-aware correlations, as shown in
the above example.
As mentioned by Xu {\em et al.}~\cite{xu15hey},
detecting fine-grained value correlation errors 
is a much more challenging
task than the normal value correlation problem.

To the best of our knowledge, \app is the first effort that
is able to check such fine-grained value correlation problems.
If we run \app on this configuration file, \app  would return:

\begin{lstlisting}[language=C, xleftmargin=.01\textwidth]
INTEGER RELATION ERROR:
Expected "key_buffer_size" >= "max_connections" * "sort_buffer_size"
\end{lstlisting} 

Compared with \app, existing efforts, \eg, EnCore, cannot 
detect fine-grained value correlation errors.

\para{Example~3: Entry missing errors.} 
Many critical system outages result from the fact that an important
entry was missing in the configuration file. 
We call such a problem an {\em entry missing error}.
In a public misconfiguration dataset~\cite{configdataset},
many MySQL failure reports were caused by
missing entry errors.
Below is a real-world entry missing error example~\cite{yin11anempirical}:
when a user wants to use OpenLDAP to enable her directory access
protocol, she needs to use the password policy overlay. This is usually
achieved via the following entries in the OpenLDAP configuration file:

\begin{lstlisting}[language=C, xleftmargin=.01\textwidth]
include schema/ppolicy.schema
overlay ppolicy
\end{lstlisting} 

When using the password policy overlay in OpenLDAP, 
users have to first include the related schema.
Leaving out the {\tt include} entry, 
as done by many users~\cite{yin11anempirical}, 
will cause failure of this LDAP. 
The user can run \app on such a misconfiguration file,
and \app would return:

\begin{lstlisting}[language=C, xleftmargin=.01\textwidth]
MISSING KEYWORD ERROR: Expected "overlay" "ppolicy"
in the same file: "include" "schema/ppolicy.schema"
\end{lstlisting} 

\para{Example~4: Singular value anomalies.} 
Many system performance problems are caused by the
anomaly that a value is set either too high or too low.
For example, a parameter relating to memory might be too large,
exhausting the RAM and causing extreme slowness or even a crash. 
Consider the following real-world misconfiguration file%
~\cite{singleValue}: a user was experiencing the ``My SQL Server 
has gone away" error.  
This is difficult to debug, since the error message is not specific.
It turns out the following line in her configuration file was problematic:

\begin{lstlisting}[language=C, xleftmargin=.01\textwidth]
max_allowed_packet = 100M
\end{lstlisting} 

The user eventually resolved the issue by replacing the above line with {\tt max\_allowed\_packet=2M}.
One possible way to reach this conclusion more quickly is to determine that the original value, 100 MB, 
is statistically deviant and extremely large for the {\tt max\_allowed\_packet} attribute. 
ConfigV can detect these
outliers. Run on the user's original configuration file, ConfigV would output:

\begin{lstlisting}[language=C, xleftmargin=.01\textwidth]
WARNING: Violated Upper Hampel Rule for max_allowed_packet with value 104857600 
\end{lstlisting} 

In the above, 104857600 represents the integer value of 100 megabytes. The idea is to output
a warning to the user that her value falls outside of a range considered normal, so that she
can make the appropriate adjustment to the value herself. In the above situation, it is 
prudent to set the value of {\tt max\_allowed\_packet} lower. We call such a value a 
\emph{singular value anomaly}.

\para{Other errors.}
\app can also deal with the configuration errors that can be detected by
existing work, such as EnCore~\cite{zhang14encore} and
CODE~\cite{yuan11context}.
A recently reported configuration error made the MySQL
daemon fail to start~\cite{syserror}.
One entry was written as 
{\tt datadir=/root/appfinder/mysql}, and the type, as well as 
format, seemed correct.
However, the problem is that this directory should not 
contain the root directory; the correct entry
should be {\tt datadir=/appfinder/mysql}.
Such an error is called a system environment-related configuration error.
Both \app and EnCore can handle misconfigurations concerning system execution.
Furthermore, \app is also able to detect type errors and syntax errors
in configuration files.
